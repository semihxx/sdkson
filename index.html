<html>
<head>
    <title>com.PhoneGap.c2dm</title>
</head>
<body>
<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
        <script type="text/javascript" src="local-notification.js"></script>
        
    <script type="text/javascript">
        var idx = 0;

        function giris_yap() {
                    alert(0);

            var xhr = new XMLHttpRequest();

            xhr.open("POST", "http://crm.essentebilisim.com/crmlogin", true);

            var params = 'username=semih@essentebilisim.com'
            '&password=a';
            params = params.replace(/%20/g, '+');
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    alert(1);
                    setTimeout(show, 100);
                }
            }
            xhr.send(params);

        }

            document.addEventListener('deviceready', function () {
                document.addEventListener('deviceready', function () {
               var now                  = new Date().getTime(),
                _60_seconds_from_now = new Date(now + 60);
                window.plugin.notification.local.add({
                    id:      1,
                    title:   'Reminder',
                    message: 'Dont forget to buy some flowers.',
                    repeat:  'weekly',
                    date:    _60_seconds_from_now
                });
            }, false);

                giris_yap();
            });
        function show() {
                    alert(3);


            $.ajax({
                url: "http://crm.essentebilisim.com/api/timeline?new=2&count=1&callback=?",
                // the name of the callback parameter, as specified by the YQL service
                jsonp: "callback",
                // tell jQuery we're expecting JSONP
                dataType: "jsonp",

data: {
        format: "json"
    },
 
                // work with the response
                success: function (response) {
                    alert(5);

                    var len = response.length;
                    for (var i = len - 1; i >= 0; i--) {
                        idx++;
                        var now = new Date().getTime();
                        console.log(response[i]);

                        window.plugin.notification.local.add({
                            id: idx,
                            title: response[i].prname,
                            message: response[i].mission + "-" + response[i].pname,
                            repeat: 'weekly',
                            date: now
                        });

                    };
                },
                 error: function (xhr, ajaxOptions, thrownError) {
                    alert(xhr.status);
                    alert(thrownError);
                  }
            });


        }



    </script>
    <div id="home">
        <div id="app-status-div">
            <ul id="app-status-ul">
                <li>Cordova PushNotification Plugin Demo</li>
            </ul>
        </div>
    </div>
</body>
</html>