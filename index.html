<html>
<head>
    <title>com.PhoneGap.c2dm</title>
</head>
<body>
<script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
 <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
 <script src="jquery.jsonp-2.1.4.min.js"></script>
        <script type="text/javascript" src="local-notification.js"></script>
        
    <script type="text/javascript">
        var idx = 0;

        function giris_yap() {
                    alert(0);

            var xhr = new XMLHttpRequest();

            xhr.open("POST", "http://crm.essentebilisim.com/crmlogin", true);

            var params = 'username=semih@essentebilisim.com'
            '&password=a';
            params = params.replace(/%20/g, '+');
            xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
            xhr.onreadystatechange = function () {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    alert(1);
                    setTimeout(show, 100);
                }
            }
            xhr.send(params);

        }

            document.addEventListener('deviceready', function () {
                document.addEventListener('deviceready', function () {
               var now                  = new Date().getTime(),
                _60_seconds_from_now = new Date(now + 60);
                window.plugin.notification.local.add({
                    id:      1,
                    title:   'Reminder',
                    message: 'Dont forget to buy some flowers.',
                    repeat:  'weekly',
                    date:    _60_seconds_from_now
                });
            }, false);

                giris_yap();
            });
        function show() {
                    alert(3);
$.jsonp({
        url: 'http://crm.essentebilisim.com/api/timeline?new=2&count=1',
        callbackParameter: 'callback',
        success: function(response, status) {
            var len = response.length;
                    for (var i = len - 1; i >= 0; i--) {
                        idx++;
                        alert(111);
                        var now = new Date().getTime();
                        console.log(response[i]);

                        window.plugin.notification.local.add({
                            id: idx,
                            title: response[i].prname,
                            message: response[i].mission + "-" + response[i].pname,
                            repeat: 'weekly',
                            date: now
                        });

                    };
        },
        error: function(){
            $('#your-tweets').append('<li>There was an error loading the feed');
        }

    });



           


        }



    </script>
    <div id="home">
        <div id="app-status-div">
            <ul id="app-status-ul">
                <li>Cordova PushNotification Plugin Demo</li>
            </ul>
        </div>
    </div>
</body>
</html>